name: Deploy

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install Frontend Dependencies
        run: |
          cd frontend
          npm install
      
      - name: Install Backend Dependencies
        run: |
          cd backend
          npm install
      
      - name: Build Frontend
        run: |
          cd frontend
          CI=false npm run build
        continue-on-error: true
      
      - name: Security Scan
        run: |
          echo "Security scan placeholder - implement security scanning here"
  
  deploy-frontend:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: Vercel Auto-Deploy
        run: |
          echo "Vercel automatically deploys from GitHub when connected."
          echo "No manual deployment needed via GitHub Actions."
          echo "Check Vercel dashboard for deployment status."
          echo ""
          echo "To verify Vercel is connected:"
          echo "1. Go to Vercel dashboard"
          echo "2. Check Settings â†’ Git"
          echo "3. Ensure GitHub repository is connected"
  
  deploy-backend:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: Railway Auto-Deploy
        run: |
          echo "Railway automatically deploys from GitHub when connected."
          echo "No manual deployment needed via CLI."
          echo "Backend should be deployed at: https://directory3-production.up.railway.app"
  
  health-check:
    needs: [deploy-frontend, deploy-backend]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: Health Check
        run: |
          echo "Health check placeholder - implement health checks here"
          echo "Check frontend: https://your-app.vercel.app"
          echo "Check backend: https://your-app.railway.app/health"

